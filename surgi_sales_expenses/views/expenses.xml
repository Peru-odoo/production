<odoo>
    <data>


        <record id="tree_view_hr_expense_inherit" model="ir.ui.view">
            <field name="name">name.hr.expense.inherit.tree</field>
            <field name="model">hr.expense</field>
            <field name="inherit_id" ref="hr_expense.view_my_expenses_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="total_expense_amount" sum="total_expense_amount"/>
                    <field name="operations_type" readonly="1" force_save="1"/>

                </xpath>

            </field>
        </record>



        <record id="tree_view_hr_expense_inherit" model="ir.ui.view">
            <field name="name">name.hr.expense.inherit.tree</field>
            <field name="model">hr.expense</field>
            <field name="inherit_id" ref="hr_expense.view_my_expenses_tree"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='state']" position="after">
                    <field name="total_expense_amount" sum="total_expense_amount"/>
                    <field name="operations_type"/>

                </xpath>

            </field>
        </record>


        <record id="expense_accounting_reviewed" model="res.groups">
            <field name="name">Accounting Reviewed</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>
        <record id="expense_treasury_manager" model="res.groups">
            <field name="name">Treasury Manager</field>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Inherit Form View to Modify it -->
        <record id="form_view_hr_expense_hr_expense" model="ir.ui.view">
            <field name="name">name.hr.expense.inherit.form</field>
            <field name="model">hr.expense</field>
            <field name="inherit_id" ref="hr_expense.hr_expense_view_form"/>
            <field name="arch" type="xml">
                 <xpath expr="//button[@name='action_submit_expenses']" position="after">
                    <button name="get_all_operation_type" type="object" string="Get All Operation Type" groups="surgi_sales_expenses.expenses_get_all_operation_type_group"/>
                </xpath>


                <xpath expr="//field[@name='date']" position="attributes">
                    <attribute name="readonly">1</attribute>
                </xpath>

                <xpath expr="//field[@name='analytic_account_id']" position="attributes">
                    <attribute name="required">1</attribute>
                    <attribute name="options">{"no_create_edit": True}</attribute>
                    <attribute name="options">{"no_create": True}</attribute>


                </xpath>

                <xpath expr="//button[@name='action_submit_expenses']" position="attributes">
                    <attribute name="attrs">{}</attribute>
                </xpath>

                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="is_sales" invisible="1"/>
                    <field name="sales_id"
                           attrs="{'required':['|',('sale_order_mandatory','=',True),('is_sales','=',True)]}"/>
                    <field name="sales_state"/>
                    <!--                    <field name="operation_type_id"/>-->
                    <field name="operations_type" force_save="1" readonly="1"/>
                    <field name="is_expenses_ids" invisible="1"/>
                    <field name="partner_surgeon_id"/>
                    <field name="event_id"/>
                    <field name="num_day_expire" invisible="1"/>
                    <field name="sale_order_mandatory" invisible="1"/>

                </xpath>
                <xpath expr="//sheet" position="inside">
                    <notebook>
                        <page string="Expenses">
                            <field name="expenses_lines_ids">
                                <tree editable="bottom">
                                    <field name="expensescc_id" readonly="1" force_save="1"/>
                                    <field name="date" readonly="1" force_save="1"/>
                                    <field name="total_amount" readonly="1" sum="total_amount" force_save="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </xpath>

            </field>
        </record>


        <!-- Inherit Form View to Modify it -->
        <record id="form_view_hr_expense_sheet_inherit" model="ir.ui.view">
            <field name="name">name.hr.expense.sheet.form.inherit</field>
            <field name="model">hr.expense.sheet</field>
            <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_form"/>
            <field name="arch" type="xml">

                <xpath expr="//group[@name='employee_details']" position="after">
                    <group>
                        <field name="account_reviewed"/>
                        <field name="treasury_manager"/>
                        <field name="check_access_expense"/>
                    </group>
                </xpath>


                <xpath expr="//field[@name='expense_line_ids']" position="attributes">
                    <attribute name="attrs">{'readonly':[('check_access_expense','=',False)]}</attribute>
                </xpath>
                <xpath expr="//field[@name='sale_order_id']" position="after">
                    <field name="sales_id" optional="hide"/>
                </xpath>


                <xpath expr="//button[@name='action_sheet_move_create']" position="before">

                    <button name="button_account_reviewed" string="Accounting Reviewed"
                            type="object" class="oe_highlight o_expense_sheet_post"
                            groups="surgi_sales_expenses.expense_accounting_reviewed"
                            attrs="{'invisible':['|',('account_reviewed','=',True),('state','in',('draft','submit'))]}"
                    />

                    <button name="button_treasury_manager" string="Treasury Manager"
                            type="object" class="oe_highlight o_expense_sheet_post"
                            groups="surgi_sales_expenses.expense_treasury_manager"
                            attrs="{'invisible':['|',('treasury_manager','=',True),('state','in',('draft','submit'))]}"
                    />
                    <!--                    '|',('state', '!=', 'approve'),-->

                </xpath>

                <xpath expr="//button[@name='action_sheet_move_create']" position="attributes">
                    <attribute name="attrs">{'invisible':['|','|',('state', '!=',
                        'approve'),('account_reviewed','=',False),('treasury_manager','=',False),]}
                    </attribute>
                </xpath>

            </field>
        </record>

    </data>
</odoo>